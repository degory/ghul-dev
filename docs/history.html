<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>history | ghūl programming language</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="stylesheet" href="/prism-vsc-dark-plus.css">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="ghūl programming language">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1fba5f60.css" as="style"><link rel="preload" href="/assets/js/app.931308c2.js" as="script"><link rel="preload" href="/assets/js/2.d0d5977e.js" as="script"><link rel="preload" href="/assets/js/1.a053b9db.js" as="script"><link rel="preload" href="/assets/js/38.526ee4bc.js" as="script"><link rel="prefetch" href="/assets/js/10.7cbc8b3d.js"><link rel="prefetch" href="/assets/js/11.f206c2fa.js"><link rel="prefetch" href="/assets/js/12.8e113096.js"><link rel="prefetch" href="/assets/js/13.4fc459fc.js"><link rel="prefetch" href="/assets/js/14.79be315a.js"><link rel="prefetch" href="/assets/js/15.75678467.js"><link rel="prefetch" href="/assets/js/16.8c2a8dca.js"><link rel="prefetch" href="/assets/js/17.4659f144.js"><link rel="prefetch" href="/assets/js/18.78f87d15.js"><link rel="prefetch" href="/assets/js/19.687fa966.js"><link rel="prefetch" href="/assets/js/20.f8afd611.js"><link rel="prefetch" href="/assets/js/21.359314cd.js"><link rel="prefetch" href="/assets/js/22.1f905eaa.js"><link rel="prefetch" href="/assets/js/23.7b2e0ca2.js"><link rel="prefetch" href="/assets/js/24.73c8580c.js"><link rel="prefetch" href="/assets/js/25.f278fd52.js"><link rel="prefetch" href="/assets/js/26.96870961.js"><link rel="prefetch" href="/assets/js/27.9e58ff48.js"><link rel="prefetch" href="/assets/js/28.faf3d70b.js"><link rel="prefetch" href="/assets/js/29.6acc86b5.js"><link rel="prefetch" href="/assets/js/3.789d2799.js"><link rel="prefetch" href="/assets/js/30.c12dd05b.js"><link rel="prefetch" href="/assets/js/31.4dcb03e7.js"><link rel="prefetch" href="/assets/js/32.f4697606.js"><link rel="prefetch" href="/assets/js/33.82b08237.js"><link rel="prefetch" href="/assets/js/34.df6c2df6.js"><link rel="prefetch" href="/assets/js/35.52819f56.js"><link rel="prefetch" href="/assets/js/36.56f46416.js"><link rel="prefetch" href="/assets/js/37.09085ea4.js"><link rel="prefetch" href="/assets/js/39.f0b47ceb.js"><link rel="prefetch" href="/assets/js/4.2750cc6e.js"><link rel="prefetch" href="/assets/js/40.ad40d8df.js"><link rel="prefetch" href="/assets/js/41.4fec791f.js"><link rel="prefetch" href="/assets/js/42.adc2cd0c.js"><link rel="prefetch" href="/assets/js/43.a13f7e0a.js"><link rel="prefetch" href="/assets/js/44.66e71085.js"><link rel="prefetch" href="/assets/js/5.a0237d0a.js"><link rel="prefetch" href="/assets/js/6.b7ad37cd.js"><link rel="prefetch" href="/assets/js/7.a507e3fa.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.271bc088.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1fba5f60.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ghūl programming language</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">overview</a></li><li><a href="/getting-started.html" class="sidebar-link">getting started</a></li><li><a href="/language-basics.html" class="sidebar-link">language basics</a></li><li><a href="/definitions.html" class="sidebar-link">definitions</a></li><li><a href="/control-flow.html" class="sidebar-link">control flow</a></li><li><a href="/functional-programming.html" class="sidebar-link">functional programming</a></li><li><a href="/object-oriented-programming.html" class="sidebar-link">object oriented programming</a></li><li><a href="/generics.html" class="sidebar-link">generics</a></li><li><a href="/dotnet-integration.html" class="sidebar-link">.NET integration</a></li><li><a href="/grammar.html" class="sidebar-link">grammar</a></li><li><a href="/resources.html" class="sidebar-link">resources</a></li><li><a href="/history.html" aria-current="page" class="active sidebar-link">history</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/history.html#background" class="sidebar-link">background</a></li><li class="sidebar-sub-header"><a href="/history.html#tombstones" class="sidebar-link">tombstones</a></li><li class="sidebar-sub-header"><a href="/history.html#the-l-compiler" class="sidebar-link">the L compiler</a></li><li class="sidebar-sub-header"><a href="/history.html#l-to-l-transpiler" class="sidebar-link">L to L transpiler</a></li><li class="sidebar-sub-header"><a href="/history.html#l-to-ghul-and-ghul-to-l-transpilers" class="sidebar-link">L to ghūl and ghūl to L transpilers</a></li><li class="sidebar-sub-header"><a href="/history.html#first-ghul-bootstrap" class="sidebar-link">first ghūl bootstrap</a></li><li class="sidebar-sub-header"><a href="/history.html#net-backend" class="sidebar-link">.NET backend</a></li><li class="sidebar-sub-header"><a href="/history.html#full-self-hosting-on-net" class="sidebar-link">full self-hosting on .NET</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="history"><a href="#history" class="header-anchor">#</a> history</h1> <h2 id="background"><a href="#background" class="header-anchor">#</a> background</h2> <p>The ghūl <a href="https://github.com/degory/ghul" target="_blank" rel="noopener noreferrer">compiler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a <a href="https://en.wikipedia.org/wiki/Self-hosting_(compilers)" target="_blank" rel="noopener noreferrer">self-hosting compiler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, capable of compiling itself from its own source code.</p> <p><a href="https://en.wikipedia.org/wiki/Bootstrapping_(compilers)" target="_blank" rel="noopener noreferrer">Bootstrapping<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> a new compiler for a new language is a classic chicken-and-egg problem: you need a compiler to compile your new compiler, but that compiler doesn’t exist yet.</p> <p>The solution is to write the initial compiler in a language that does exist; then, once that compiler is sufficiently reliable, its source code must be translated into the new language, giving a compiler that can compile the new language, including its own source code. It's best to keep the initial compiler simple, for example by handling only a subset of the new language and producing unoptimized code. The smaller and simpler the initial compiler is, the less work is involved in translating it into the new language, making bootstrapping easier.</p> <h2 id="tombstones"><a href="#tombstones" class="header-anchor">#</a> tombstones</h2> <p>When discussing bootstrapping, it's common to use <a href="https://en.wikipedia.org/wiki/Tombstone_diagram" target="_blank" rel="noopener noreferrer">tombstone<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> diagrams. In a T shaped tombstone diagram, the T represents a particular version of a compiler. Within the T, three languages are named: the source language, the target language, and the implementation language. The target language is typically some kind of IL or machine language, but for a transpiler, the target language is source code.</p> <p>For example, a compiler C that reads source in language S, translates it to language T, and is implemented in language I, would be depicted like this:</p> <p><img src="bootstrap-tombstone-example.drawio.svg" alt="Example tombstone showing compiler for language S, targeting language T, written in language I"></p> <h2 id="the-l-compiler"><a href="#the-l-compiler" class="header-anchor">#</a> the L compiler</h2> <p>ghūl grew out of another language I designed, years before, named L, and I used L in the early stages of the ghūl compiler development. The initial ghūl compiler could in principle have been written in any pre-existing language with a compiler; I chose L because I knew I could easily make changes to the L language and compiler if needed to support the ghūl bootstrap.</p> <p>(Plus, why spend ages designing a programming language and building a compiler for it, if you're not going to use it to build <em>another</em> compiler for a <em>another</em> programming language you've invented? 😂)</p> <p>Like the ghūl compiler, the L compiler is self-hosting. It was originally written in C++ and I bootstrapped it manually by hand translating the C++ source into equivalent L. This tedious process was made easier by carefully sticking to an L-compatible subset of C++ when writing the initial C++ version of the L compiler.</p> <p><img src="bootstrap-L-compiler-bootstrap-from-C++.drawio.svg" alt="bootstrapping the L compiler"></p> <h2 id="l-to-l-transpiler"><a href="#l-to-l-transpiler" class="header-anchor">#</a> L to L transpiler</h2> <p>The first version of the ghūl compiler wasn't really a compiler and it didn't understand ghūl. It was actually a simple L source code to L source code transpiler, written in L.</p> <p><img src="bootstrap-L-to-L-transpiler.drawio.svg" alt="The L to L transpiling 'ghul compiler'"></p> <p>This transpiler was in part a strategic piece of scaffolding, intended to support the bootstrap process. I wanted to automate the process of transforming the compiler source code from L to ghūl and so avoid the tedious hand-translation I'd had to do previously when bootstrapping the L compiler. Some parts of the L to L transpiler do survive in the real ghūl compiler (the lexical analyzer and the parser), but the rest was discarded once the initial bootstrap was complete</p> <p>I added a compiler driver to the L to L transpiler, so it could call the existing L compiler, passing in the L code it generated. The result was a compiler that consumed L source code and generated x64 machine code, but which also generated transpiled L source code as an intermediate step.</p> <p><img src="bootstrap-L-to-L-transpiler-with-L-compiler.drawio.svg" alt="L compiler and the L to L transpiling 'ghul compiler'"></p> <p>This simple 'ghūl compiler' still understood no ghūl, performed no semantic analysis, and generated L source code as its 'object code'. It relied completely on the L compiler for semantic error detection and reporting and for x64 code generation.</p> <h2 id="l-to-ghul-and-ghul-to-l-transpilers"><a href="#l-to-ghul-and-ghul-to-l-transpilers" class="header-anchor">#</a> L to ghūl and ghūl to L transpilers</h2> <p>I enhanced the L to L transpiler so it could transpile L to ghūl and ghūl to L. The transpiler was still written in L and still relied on the L compiler as a backend to generate the x64 executable from transpiled the L code.</p> <p><img src="bootstrap-gh%C5%ABl-and-L-transpilers.drawio.svg" alt="Transpilers handling both L and ghul"></p> <h2 id="first-ghul-bootstrap"><a href="#first-ghul-bootstrap" class="header-anchor">#</a> first ghūl bootstrap</h2> <p>Then I passed the L source code of the ghūl to L transpiler through the L to ghūl transpiler, generating output in ghūl. This yielded a ghūl to L transpiler written in ghūl:</p> <p><img src="bootstrap-gh%C5%ABl-self-hosting-transpiler.drawio.svg" alt="Bootstrapping the ghūl to L transpiler"></p> <p><strong>This step is the first bootstrap</strong>, and it's why I started with a transpiler: the source code of the ghūl to L transpiler, which was originally L, has now been mechanically transformed into ghūl. This new transpiler is written in ghūl, and it can transpile itself into L: it has become self-hosting, albeit still dependent on the L compiler to generate machine code from L.</p> <h2 id="net-backend"><a href="#net-backend" class="header-anchor">#</a> .NET backend</h2> <p>Gradually, I integrated more semantic analysis into the ghūl compiler: representations of classes, traits, methods, functions, variables, etc., along with corresponding error checking and reporting.</p> <p>With the compiler now capable of constructing a detailed representation of input programs, I began implementing a .NET IL generation backend. I did this in stages, adding support for expressions and local variable definitions first, then working through the other more advanced language constructs.</p> <p>I initially used scaffolding to test generated IL snippets, because the compiler wasn't capable of generating completely self-contained IL programs. As I implemented .NET IL for the various ghūl language features, and the compiler became increasingly more capable, I guarded against regressions by building <a href="https://github.com/degory/ghul/tree/main/integration-tests" target="_blank" rel="noopener noreferrer">integration tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as I went. The regression test runner started out as a collection of bash scripts, but as the compiler stabilized, I <a href="https://github.com/degory/ghul-test" target="_blank" rel="noopener noreferrer">rewrote it in ghūl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The initial regression suite included tests asserting correct IL generation for all the different ghūl language constructs as I implemented them. As soon as the compiler could generate code for complete programs, I added further integration tests exercising generated code execution.</p> <p>I continued to maintain the transpilation to L source code backend alongside the .NET IL backend throughout this process, until the .NET IL backend was sufficiently complete and stable to self-host the compiler on .NET.</p> <p>This phase was complicated by L's LLVM backend and by its standard library, with features like generic collections and file handling, which interfaced with glibc and were not source compatible with similar facilities in .NET. I needed to be able to use these facilities in the compiler source, and have the built compiler run on both glibc and .NET. I solved this by cloning a small subset of the .NET standard library in ghūl, and then porting references to the L standard library in the ghūl compiler to use this .NET library subset, thus enabling the compiler to be built on and target both L and .NET.</p> <h2 id="full-self-hosting-on-net"><a href="#full-self-hosting-on-net" class="header-anchor">#</a> full self-hosting on .NET</h2> <p>Finally, with the compiler reliably self-hosting on .NET, I removed the L transpilation backend and the .NET library subset, and the compiler was successfully bootstrapped onto .NET.</p> <p>You can see this process in the Git history in the <a href="https://github.com/degory/ghul" target="_blank" rel="noopener noreferrer">ghūl compiler repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, going all the way back to the initial commit.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/resources.html" class="prev">
        resources
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.931308c2.js" defer></script><script src="/assets/js/2.d0d5977e.js" defer></script><script src="/assets/js/1.a053b9db.js" defer></script><script src="/assets/js/38.526ee4bc.js" defer></script>
  </body>
</html>
